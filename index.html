!DOCTYPE html><html><head><title>构建自己的docker image</title><meta charset='utf-8'><link href='https://d31qtcb7c58z3n.cloudfront.net/res-min/themes/marxico.css' rel='stylesheet'><style>

          .note-content  {font-family: "Helvetica Neue", Arial, "Hiragino Sans GB", STHeiti, "Microsoft YaHei", "WenQuanYi Micro Hei", SimSun, Song, sans-serif;}
        </style></head><body><div id='preview-contents' class='note-content'>
                              
                          
      
      
      
        <h1 id="构建自己的docker-image">构建自己的docker image</h1>
      
        <p></p>
    
        <p>本节包含以下内容：</p>
    
        <ol><li rel="1">Managing and working with images locally on your Docker host.</li>
          <li rel="2">Creating basic images.</li>
          <li rel="3">Uploading images to Docker Hub Registry.</li>
</ol>



<h2 id="listing-images-on-the-host">Listing images on the host</h2>

<pre class="prettyprint hljs-dark"><code class="hljs cpp">$ docker images<br><br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>ubuntu              <span class="hljs-number">14.04</span>               <span class="hljs-number">1</span>d073211c498        <span class="hljs-number">3</span> days ago          <span class="hljs-number">187.9</span> MB<br>busybox             latest              <span class="hljs-number">2</span>c5ac3f849df        <span class="hljs-number">5</span> days ago          <span class="hljs-number">1.113</span> MB<br>training/webapp     latest              <span class="hljs-number">54</span>bb4e8718e8        <span class="hljs-number">5</span> months ago        <span class="hljs-number">348.7</span> MB<br></code></pre>
  
            <p>执行docker images会获得以下信息：</p>

            <ul><li>What repository they came from, for example ubuntu</li>
              <li>The tags for each image, for example 14.04</li>
              <li><p>The image ID of each image.</p>
  
                <pre class="prettyprint hljs-dark"><code class="hljs groovy">$ docker run -t -i <span class="hljs-string">ubuntu:</span><span class="hljs-number">14.04</span> <span class="hljs-regexp">/bin/</span>bash<br></code></pre></li>
</ul>

<p>用tag指定某个image <br>
    如果不指定 tag，则使用<code>ubuntu:latest</code></p>
    
    
    
  <h2 id="getting-a-new-image">Getting a new image</h2>
  
  <pre class="prettyprint hljs-dark"><code class="hljs crystal"><span class="hljs-variable">$ </span>docker pull centos<br></code></pre>
  
    <p>下载image</p>
    
    
    
    <h2 id="finding-images">Finding images</h2>
    
    <p>可以到docker hub上去找镜像，也可以用<code>docker search</code>命令去找</p>
    
    <p>假如你需要一个安装有sinatara的ruby环境，就可以使用<code>docker search sinatra</code>查找</p>
    
    <pre class="prettyprint hljs-dark"><code class="hljs crystal"><span class="hljs-variable">$ </span>docker search sinatra<br></code></pre>
    
    
    
      <h2 id="pulling-our-image">Pulling our image</h2>
      
      <pre class="prettyprint hljs-dark"><code class="hljs crystal"><span class="hljs-variable">$ </span>docker pull training/sinatra<br></code></pre>
      
      
      
        <h2 id="creating-our-own-images">Creating our own images</h2>
        
        <ol><li rel="1">You can update a container created from an image and commit the results to an image.</li>
          <li rel="2">You can use a Dockerfile to specify instructions to create an image.</li>
          </ol>
          
          
          
          <h3 id="updating-and-committing-an-image">Updating and committing an image</h3>
          
          <p>To update an image you first need to create a container from the image you’d like to update</p>
          
          <pre class="prettyprint hljs-dark"><code class="hljs elixir"><span class="hljs-variable">$ </span>docker run -t -i training/sinatra /bin/bash<br>root<span class="hljs-variable">@0b2616b0e5a8</span><span class="hljs-symbol">:/</span><span class="hljs-comment">#</span><br></code></pre>
          
              <p>Inside our running container first let’s update Ruby:</p>
              
              <pre class="prettyprint hljs-dark"><code class="hljs cpp">root@<span class="hljs-number">0</span>b2616b0e5a8:/<span class="hljs-preprocessor"># apt-get install -y ruby2<span class="hljs-number">.0</span>-dev</span><br></code></pre>
              
                <p>Now let’s add the json gem:</p>
                
                <pre class="prettyprint hljs-dark"><code class="hljs cpp">root@<span class="hljs-number">0</span>b2616b0e5a8:/<span class="hljs-preprocessor"># gem2<span class="hljs-number">.0</span> install json</span><br></code></pre>
                
                  <p>Once this has completed let’s exit our container using the exit command.</p>
                  
                  <pre class="prettyprint hljs-dark"><code class="hljs bash">$ docker commit -m <span class="hljs-string">"Added json gem"</span> <span class="hljs-operator">-a</span> <span class="hljs-string">"Kate Smith"</span> \<br><span class="hljs-number">0</span>b2616b0e5a8 ouruser/sinatra:v2<br><br><span class="hljs-number">4</span>f177bd27a9ff0f6dc2a830403925b5360bfe0b93d476f7<span class="hljs-built_in">fc</span>3231110e7f71b1c            <br></code></pre>

                          <p>-m 参数指明提交的注释，-a 指明作者  容器ID 0b2616b0e5a8表明是从这个容器创建的image, 最后ouruser/sinatra:v2指明了image的名字</p></div></body></html></p></p></p></p></p></p></p></ul></p></code></li></ol></p></body>
  </style></title></head></html>
